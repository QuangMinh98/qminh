jQuery(document).ready(function($){var more_server_html=[];var _playing_name=$('.tapphim.playing').text();$('ul.listep').find('li').each(function(index,el){var _link='';var _class='';$(el).find('a.tapphim').each(function(index2,el2){if($(el2).text()==_playing_name){_link=$(el2).attr('href');}
if($(el2).hasClass('playing')){_class='active';}});if(_link!=''){var _name='Server '+(index+1);if(index==0){_name='Server 1';}
var _html='<a class="'+_class+'" href="'+_link+'">'+_name+'</a>';more_server_html.push(_html);}});$('#more-servers').html(more_server_html.join(''));$.ajax({type:"POST",url:AJAX_URL+"getExtraLinks",data:{epid:$('input[name="_epid"]').val()},success:function(json){if(json.success){$.each(json.links,function(index,val){if(val!=''){var sv_name=more_server_html.length+1
var _html='<a class="o_r_extra" data-url="'+val+'" href="javascript:void(0)">Server '+sv_name+'</a>';more_server_html.push(_html);}})
$('#more-servers').html(more_server_html.join(''));}}});$(document).on('click','.o_r_extra',function(){var $this=$(this)
var ifrm='<iframe src="'+$this.data('url')+'" scrolling="no" frameborder="0" style="width:100%; height:100%;" allowfullscreen="yes" frameborder="0"></iframe>';$('#more-servers > a').removeClass('active');$this.addClass('active');$('#players').html(ifrm);return false;})
autoSizePlayer();$(window).on('resize',function(){autoSizePlayer();});jQuery('a.reportError').click(function(event){jQuery('.play_reporterror').stop().slideToggle('slow');ascrollTo('.play_reporterror');return false;});jQuery('form#report-error-form').submit(function(event){_loading(true);var mess=jQuery(this).find('#message').val();if((mess.length<30)||(mess.length>900)){$.prompt("Nội dung phải từ 30 đên 900 ký tự !");}else{$.ajax({url:AJAX_URL+'reportFilmError',type:'POST',data:{filmid:jQuery('a.reportError').data('id'),mess:mess},}).done(function(data){if(data.success){jQuery(this).find('#message').val('');jQuery('.play_reporterror').slideUp();}
$.prompt(data.mess);}).fail(function(){$.prompt("Đã xảy ra lỗi, bạn vui lòng reload trang web và thử lại, xin cảm ơn!");});}
_loading(false);return false;});jQuery('.previous_ep_btn').click(function(event){var prev=jQuery('.tapphim.playing').prev();var url=prev.attr('href');if(typeof url!='undefined'){location.replace(url);}});jQuery('.next_ep_btn').click(function(event){var next=jQuery('.tapphim.playing').next();var url=next.attr('href');if(typeof url!='undefined'){location.replace(url);}});jQuery('a.downloadFilm').click(function(event){_loading(true);var epid=jQuery('input[name="_epid"]').val();var ep_title=jQuery('#ep_'+epid).data('title');if(epid){$.ajax({url:AJAX_URL+'downloadFilm',type:'POST',data:{'epid':epid,'ep_title':ep_title},}).done(function(data){if(data.success){jQuery('#play_downloadfilm').html(data.html);jQuery('#play_downloadfilm').slideDown('slow');ascrollTo('#play_downloadfilm');}else{$.prompt(data.mess);}}).fail(function(){$.prompt("Đã xảy ra lỗi, bạn vui lòng reload trang web và thử lại, xin cảm ơn!");});}
_loading(false);return false;});jQuery('#switch-light').click(function(event){if(jQuery(this).hasClass('on')){jQuery(this).addClass('off');jQuery(this).removeClass('on');jQuery(this).text('Bật đèn');jQuery('.light').fadeIn();jQuery('#players').css('z-index','1002');}else{jQuery(this).addClass('on');jQuery(this).removeClass('off');jQuery(this).text('Tắt đèn');jQuery('.light').fadeOut();jQuery('#players').css('z-index','9');}
return false;});if($('.loadplayer').hasClass('blocked')&&(readCookie('animetvn_dh_qaa')==null)){$('#players').remove();var qaa='<div class="qaa" style=""><div class="qaa-inner">';qaa+='<div class="qaa-header">Chú ý</div>';qaa+='<div class="qaa-content">';qaa+='<p>Phim có nội dung nhạy cảm bạn đã đủ 18 tuổi chưa ? ( vui lòng trả lời đáp án "tôi trên mười tám tuổi") Nhớ điền vào ô nội dung đó BẰNG CHỮ VÀ KHÔNG DẤU để được xem tiếp bộ phim này </p>';qaa+='<form class="qaa-frm">';qaa+='<label for="qaa-a">Câu trả lời</label>';qaa+='<input type="text" name="qaa-a" id="qaa-a" value="" />';qaa+='<button class="qaa-btn">Gửi</button>';qaa+='</form>';qaa+='</div>';qaa+='</div></div>';$('body').append(qaa);}
$(document).on('click','.qaa-btn',function(){var a=$('#qaa-a').val();if(in_array(a,['toitrenmuoitamtuoi','toi tren muoi tam tuoi','Toitrenmuoitamtuoi','Toi tren muoi tam tuoi'])){createCookie('animetvn_dh_qaa','1',30);location.reload();}else{alert('Đáp án chưa chính xác.')}
return false;})});function loadEps(slug,name)
{jQuery('.eplist > .listep > li').hide();jQuery('#'+slug).fadeIn('400');jQuery('span.current_sn').text(name);jQuery('#choose-server li a').removeClass('current');var res=slug.substring(3,slug.length);jQuery('#choose-server li a[data-slug="'+res+'"]').addClass('current');epScroll();}
function requestJsPlayer($epid)
{_loading(true);$.ajax({url:AJAX_URL+'htmlplayer',type:'POST',data:{epid:$epid},}).done(function(a){if(a){ascrollTo("h1.main_page_title");$("#players").html(a).addClass('playing');}else{$.prompt("Tập phim bị lỗi, xin vui lòng chọn tập khác, xin cám ơn!");}}).fail(function(){console.log("error");}).always(function(){console.log("complete");});_loading(false);}
function requestSwfPlayer($epid)
{_loading(true);$.ajax({url:AJAX_URL+'swfplayer',type:'POST',data:{epid:$epid},}).done(function(a){if(a){ascrollTo("h1.main_page_title");$(".load_player_swf").html(a).addClass('playing');}else{$.prompt("Tập phim bị lỗi, xin vui lòng chọn tập khác, xin cám ơn!");}}).fail(function(){console.log("error");}).always(function(){console.log("complete");});_loading(false);}
function dhLoadMoreUrl($epid,$next)
{$.ajax({url:AJAX_URL+'htmlplayer',type:'POST',data:{epid:$epid,next:parseInt($next)},}).done(function(a){$(".loadplayer").html(a);}).fail(function(){console.log("error");});}
function saveScreenShot(Z){var H=document.getElementById(jwplayer(Z).id);var B=(H)?H.querySelector("video"):undefined;if(B){jwplayer("myElement").pause(true);var F=1;var D=document.createElement("canvas");D.width=B.videoWidth*F;D.height=B.videoHeight*F;Dwidth=window.innerWidth*0.5;Dwidth100=Dwidth/(D.width/100);Dheight=(D.height/100)*Dwidth100;if(Dheight>600){Dheight=600;Dheight100=Dheight/(D.height/100);Dwidth=D.width/100*Dheight100;}
D.setAttribute("style","height:"+Dheight+"px");D.getContext("2d").drawImage(B,0,0,D.width,D.height);var G=document.createElement("div");var K=(window.innerHeight-Dheight-50)/2+"px";var L=(window.innerWidth-Dwidth)/2+"px";if(window.innerWidth<450){L="0px";Dwidth=window.innerWidth;}
var C=document.createElement("div");var E="position: fixed;z-index: 9999999999999;width:"+Dwidth+"px; left: "+L+";top:0";E+=";padding: 10px  0px; background: #fff;margin-top: 80px;";E+="text-align: center;border: 1px solid rgba(0, 0, 0, 0.23);";C.setAttribute("style","display: block;");C.appendChild(D);G.setAttribute("id","popupSave");G.setAttribute("style",E);var J=document.createElement("span");J.innerHTML='Nhấn chuột phải vào hình và chọn :( Lưu hình ảnh thành ) hoặc (Save image as)';var I=document.createElement("a");I.innerHTML="Close";E="display: inline-block; margin: 0px auto;background-color: #337ab7;";E+="margin-top: 10px; padding: 5px 10px;";E+="color: #fff; border-radius: 5px; border: 1px solid #ccc; cursor: pointer;";I.setAttribute("style",E);I.onclick=function(){document.getElementById("popupSave").remove();setup_video();};G.appendChild(J);G.appendChild(C);G.appendChild(I);document.body.appendChild(G)}}
function autoSizePlayer()
{var pl=$('#players');var h=0;if(pl.width()>=920){h=600;}else{h=((pl.width()*600)/920);}
pl.find('.loadplayer > iframe').height(h);if(pl.find('.play_downloadfilm_mobile').length){h+=pl.find('.play_downloadfilm_mobile').height();}
pl.height(h);pl.css('opacity',1);}
function base64_encode(data){var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc='',tmp_arr=[];if(!data){return data;}
data=unescape(encodeURIComponent(data))
do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3);}
function base64_decode(data){var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec='',tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return decodeURIComponent(escape(dec.replace(/\0+$/,'')));}
function in_array(needle,haystack,argStrict){var key='',strict=!!argStrict;if(strict){for(key in haystack){if(haystack[key]===needle){return true;}}}else{for(key in haystack){if(haystack[key]==needle){return true;}}}
return false;}